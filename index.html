<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <title>demo</title>

    <style type="text/css">
        button {
            width: 80%;
            display: block;
            background-color: #0052cc;
            color: #fff;
            border: 1px solid transparent;
            margin: 0 auto;
            margin-bottom: 30px;
        }
        .page {
            height: 100%;
            margin-top: 100px;
        }
    </style>
</head>

<body>
    <div class="page">
        <button onclick="openWechat()">调起微信</button>
        <button onclick="openMiniProgramn()">调起小程序</button>
        <button onclick="getNavigator()">navigator</button>
        <button onclick="saveImg()">保存图片</button>
        <div id="imageWrapper">
            <button onclick="toSave()">点击保存</button>
        </div>
    </div>
</body>

<script src="http://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script type="text/javascript">
    function openWechat() {
        try {
            console.log('调起微信');
            window.location.href = 'weixin://';
        } catch (e) {
            console.log('调起微信失败');
            alert(`调起微信失败:${e}`)
        }
    };
    function openMiniProgramn() {
        const params = {
            userName: 'gh_16e311dfb857',
            path: '/pages/message/message?channel_id=902&card_name=appkjhm',
            mnProgramType: '0'
        };
        try {
            console.log('调起小程序');
            const path = `baiduboxapp://v7/vendor/ad/openWXMnProgram?params=${encodeURIComponent(JSON.stringify(params))}`;
            console.log(path);
            window.location.href = `baiduboxapp://v7/vendor/ad/openWXMnProgram?params=${encodeURIComponent(JSON.stringify(params))}&callback=launchCallback`;
        } catch (e) {
            alert(`调起小程序失败:${e}`)
        }
    }
    function launchCallback(res) {
        alert(res);
    }
    function getNavigator() {
        alert(`navigator:${navigator.userAgent}`)
    }
    function saveImg() {
        const Imgurl = "https://fe-resource.cdn.bcebos.com/vector/wutong/wechat/wechat_dialog.png";
        const blob=new Blob([''], {type:'application/octet-stream'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = Imgurl;
        a.download = Imgurl.replace(/(.*\/)*([^.]+.*)/ig,"$2").split("?")[0];
        const e = document.createEvent('MouseEvents');
        e.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
        a.dispatchEvent(e);
        URL.revokeObjectURL(url);
    }
    function toSave() {
        html2canvas(document.getElementById("imageWrapper")).then(canvas => {
            let saveUrl = canvas.toDataURL('image/png')
            let aLink = document.createElement('a')
            let blob = this.base64ToBlob(saveUrl)
            let evt = document.createEvent('HTMLEvents')
            evt.initEvent('click', true, true)
            aLink.download = '二维码.jpg'
            aLink.href = URL.createObjectURL(blob)
            aLink.click()
        });
    }
    function base64ToBlob(code) {
        let parts = code.split(';base64,')
        let contentType = parts[0].split(':')[1]
        let raw = window.atob(parts[1])
        let rawLength = raw.length
        let uInt8Array = new Uint8Array(rawLength)
        for (let i = 0; i < rawLength; ++i) {
            uInt8Array[i] = raw.charCodeAt(i)
        }
        return new Blob([uInt8Array], {type: contentType})
    }
    </script>
</html>
